sudo: true
services:
- docker
language: go
env:
  global:
  - DOCKER_ORG=$(dirname ${TRAVIS_REPO_SLUG})
  - DOCKER_COMPOSE_VERSION=1.23.2
before_install:
  - sudo rm /usr/local/bin/docker-compose
  - curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname -s`-`uname -m` > docker-compose
  - chmod +x docker-compose
  - sudo mv docker-compose /usr/local/bin
go:
- "1.10.x"
script:
- "./build.sh"
- "go test"
before_deploy:
- docker login -u="${DOCKER_USERNAME}" -p="${DOCKER_PASSWORD}"
deploy:
- provider: script
  script: docker build . -t ${DOCKER_ORG}/kube-cert-manager:master &&  docker push
    ${DOCKER_ORG}/kube-cert-manager:master
  skip_cleanup: true
  on:
    branch: master
- provider: script
  script: docker build . -t ${DOCKER_ORG}/kube-cert-manager:${TRAVIS_TAG} -t ${DOCKER_ORG}/kube-cert-manager:latest
    && docker push ${DOCKER_ORG}/kube-cert-manager:${TRAVIS_TAG} && docker push ${DOCKER_ORG}/kube-cert-manager:latest
  skip_cleanup: true
  on:
    tags: true
notifications:
  email: false
